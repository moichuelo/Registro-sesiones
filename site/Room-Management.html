
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentación del proyecto Registro (DeepWiki dump)">
      
      
      
      
        <link rel="prev" href="WebSocket-Authentication.html">
      
      
        <link rel="next" href="Message-Handling.html">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Room Management - DeepWiki — Registro</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#room-management" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="DeepWiki — Registro" class="md-header__button md-logo" aria-label="DeepWiki — Registro" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DeepWiki — Registro
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Room Management
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="DeepWiki — Registro" class="md-nav__button md-logo" aria-label="DeepWiki — Registro" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    DeepWiki — Registro
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Getting-Started.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture Overview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Architecture-Overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="System-Components.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    System Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Technology-Stack.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technology Stack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Request-Processing-Pipeline.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Request Processing Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Application-Bootstrap.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Application Bootstrap
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Routing System
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Routing System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Routing-System.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Routing System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Public-Routes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Public Routes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Protected-Routes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protected Routes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="API-Endpoints.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Endpoints
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Authentication & Authorization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Authentication & Authorization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Authentication-%26-Authorization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authentication & Authorization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="User-Registration-%26-Login.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Registration & Login
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="JWT-Token-Management.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JWT Token Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="verifyToken-Middleware.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    verifyToken Middleware
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Security-Measures.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security Measures
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Real-time Communication System
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Real-time Communication System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Real-time-Communication-System.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Real-time Communication System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Socket.IO-Server-Setup.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Socket.IO Server Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="WebSocket-Authentication.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WebSocket Authentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Room Management
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="Room-Management.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Room Management
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose-and-scope" class="md-nav__link">
    <span class="md-ellipsis">
      Purpose and Scope
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#room-types" class="md-nav__link">
    <span class="md-ellipsis">
      Room Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Room Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#personal-rooms" class="md-nav__link">
    <span class="md-ellipsis">
      Personal Rooms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#admin-room" class="md-nav__link">
    <span class="md-ellipsis">
      Admin Room
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#room-assignment-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Room Assignment Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#room-based-message-routing" class="md-nav__link">
    <span class="md-ellipsis">
      Room-Based Message Routing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#room-membership-management" class="md-nav__link">
    <span class="md-ellipsis">
      Room Membership Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Room Membership Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#join-operation" class="md-nav__link">
    <span class="md-ellipsis">
      Join Operation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-leave-on-disconnect" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic Leave on Disconnect
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-emission-to-rooms" class="md-nav__link">
    <span class="md-ellipsis">
      Message Emission to Rooms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message Emission to Rooms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#targeting-specific-rooms" class="md-nav__link">
    <span class="md-ellipsis">
      Targeting Specific Rooms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broadcasting-to-multiple-rooms" class="md-nav__link">
    <span class="md-ellipsis">
      Broadcasting to Multiple Rooms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#room-naming-convention" class="md-nav__link">
    <span class="md-ellipsis">
      Room Naming Convention
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connection-lifecycle-and-room-membership" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Lifecycle and Room Membership
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technical-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Technical Implementation Details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Technical Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#room-data-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Room Data Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Authentication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Message-Handling.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Message Handling
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Product-Management.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Product Management
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Support Chat System
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Support Chat System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Support-Chat-System.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Support Chat System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="User-Chat-Interface.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Chat Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Admin-Chat-Interface.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Admin Chat Interface
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    PDF Generation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            PDF Generation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="PDF-Generation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PDF Generation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Puppeteer-PDF-Generation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Puppeteer PDF Generation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="PDFKit-PDF-Generation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PDFKit PDF Generation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Internationalization-%28i18n%29.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internationalization (i18n)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    View Layer & Templates
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            View Layer & Templates
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Template-Structure.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Template Structure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Partial-Components.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Partial Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Page-Views.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Page Views
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Static-Assets-%26-Styling.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Static Assets & Styling
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Database Schema
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            Database Schema
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Database-Schema.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Database Schema
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="usuarios-Table.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    usuarios Table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="productos-Table.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    productos Table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mensajes-Table.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mensajes Table
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="API-Reference.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="HTTP-Endpoints.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTTP Endpoints
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="WebSocket-Events.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WebSocket Events
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Deployment-%26-Configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment & Configuration
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    README
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose-and-scope" class="md-nav__link">
    <span class="md-ellipsis">
      Purpose and Scope
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#room-types" class="md-nav__link">
    <span class="md-ellipsis">
      Room Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Room Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#personal-rooms" class="md-nav__link">
    <span class="md-ellipsis">
      Personal Rooms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#admin-room" class="md-nav__link">
    <span class="md-ellipsis">
      Admin Room
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#room-assignment-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Room Assignment Architecture
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#room-based-message-routing" class="md-nav__link">
    <span class="md-ellipsis">
      Room-Based Message Routing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#room-membership-management" class="md-nav__link">
    <span class="md-ellipsis">
      Room Membership Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Room Membership Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#join-operation" class="md-nav__link">
    <span class="md-ellipsis">
      Join Operation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-leave-on-disconnect" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic Leave on Disconnect
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-emission-to-rooms" class="md-nav__link">
    <span class="md-ellipsis">
      Message Emission to Rooms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Message Emission to Rooms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#targeting-specific-rooms" class="md-nav__link">
    <span class="md-ellipsis">
      Targeting Specific Rooms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broadcasting-to-multiple-rooms" class="md-nav__link">
    <span class="md-ellipsis">
      Broadcasting to Multiple Rooms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#room-naming-convention" class="md-nav__link">
    <span class="md-ellipsis">
      Room Naming Convention
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connection-lifecycle-and-room-membership" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Lifecycle and Room Membership
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#technical-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Technical Implementation Details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Technical Implementation Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#room-data-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Room Data Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Authentication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="room-management">Room Management<a class="headerlink" href="#room-management" title="Permanent link">&para;</a></h1>
<blockquote>
<p><strong>Relevant source files</strong>
* <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js">src/sockets/socketHandler.js</a></p>
</blockquote>
<h2 id="purpose-and-scope">Purpose and Scope<a class="headerlink" href="#purpose-and-scope" title="Permanent link">&para;</a></h2>
<p>This document describes the Socket.IO room management system used to organize and route real-time messages in the support chat feature. Rooms serve as logical groupings of connected WebSocket clients, enabling targeted message delivery to specific users or user groups. The system implements two types of rooms: personal rooms for direct user-to-user communication and a collective admin room for supervision and coordination.</p>
<p>For information about Socket.IO server initialization, see <a href="/moichuelo/registro/7.1-socket.io-server-setup">Socket.IO Server Setup</a>. For details on message event handling, see <a href="Message-Handling.html">Message Handling</a>.</p>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L1-L71">src/sockets/socketHandler.js L1-L71</a></p>
<hr />
<h2 id="room-types">Room Types<a class="headerlink" href="#room-types" title="Permanent link">&para;</a></h2>
<p>The system implements two distinct room categories that serve different communication patterns:</p>
<table>
<thead>
<tr>
<th>Room Type</th>
<th>Naming Pattern</th>
<th>Purpose</th>
<th>Membership</th>
</tr>
</thead>
<tbody>
<tr>
<td>Personal Room</td>
<td><code>user:{username}</code></td>
<td>Direct message delivery to specific user</td>
<td>Single user (the username owner)</td>
</tr>
<tr>
<td>Admin Room</td>
<td><code>admins</code></td>
<td>Broadcast messages to all administrators</td>
<td>All users with <code>rol === "admin"</code></td>
</tr>
</tbody>
</table>
<h3 id="personal-rooms">Personal Rooms<a class="headerlink" href="#personal-rooms" title="Permanent link">&para;</a></h3>
<p>Every connected user automatically joins a personal room named <code>user:{username}</code> where <code>{username}</code> is the value of the <code>user</code> field from their JWT token. These rooms enable one-to-one message delivery, ensuring messages reach only the intended recipient.</p>
<h3 id="admin-room">Admin Room<a class="headerlink" href="#admin-room" title="Permanent link">&para;</a></h3>
<p>Administrators join both their personal room and a shared <code>admins</code> room. This collective room enables:</p>
<ul>
<li>Broadcasting messages from non-admin users to all online administrators</li>
<li>Admin-to-admin coordination and visibility</li>
<li>Supervision of user support requests</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L42-L43">src/sockets/socketHandler.js L42-L43</a></p>
<hr />
<h2 id="room-assignment-architecture">Room Assignment Architecture<a class="headerlink" href="#room-assignment-architecture" title="Permanent link">&para;</a></h2>
<p>The following diagram illustrates how users are assigned to rooms upon WebSocket connection:</p>
<pre class="mermaid"><code>flowchart TD

SocketConnection["Socket Connection&lt;br&gt;Established"]
ExtractUserData["Extract JWT Data&lt;br&gt;{user, name, rol}"]
JoinPersonalRoom["socket.join(Unsupported markdown: codespan)"]
CheckRole["rol === 'admin'?"]
JoinAdminRoom["socket.join('admins')"]
Complete["Connection Setup&lt;br&gt;Complete"]
ListeningEvents["Socket Listening&lt;br&gt;For Events"]

SocketConnection --&gt; ExtractUserData
ExtractUserData --&gt; JoinPersonalRoom
JoinPersonalRoom --&gt; CheckRole
CheckRole --&gt; JoinAdminRoom
CheckRole --&gt; Complete
JoinAdminRoom --&gt; Complete
Complete --&gt; ListeningEvents</code></pre>
<p><strong>Room Assignment Process</strong></p>
<p>Room assignment occurs in the <code>connection</code> event handler immediately after JWT authentication:</p>
<ol>
<li><strong>Extract User Data</strong>: The decoded JWT payload contains <code>user</code>, <code>name</code>, and <code>rol</code> fields <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L37-L37">src/sockets/socketHandler.js L37</a></li>
<li><strong>Join Personal Room</strong>: Every user joins <code>user:${user}</code> unconditionally <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L42-L42">src/sockets/socketHandler.js L42</a></li>
<li><strong>Conditional Admin Room Join</strong>: If <code>rol === "admin"</code>, user also joins the <code>admins</code> room <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L43-L43">src/sockets/socketHandler.js L43</a></li>
</ol>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L36-L43">src/sockets/socketHandler.js L36-L43</a></p>
<hr />
<h2 id="room-based-message-routing">Room-Based Message Routing<a class="headerlink" href="#room-based-message-routing" title="Permanent link">&para;</a></h2>
<p>The room system enables sophisticated message routing logic that differs based on sender role and message destination:</p>
<pre class="mermaid"><code>flowchart TD

MensajePrivado["mensaje_privado Event&lt;br&gt;{para, mensaje}"]
ExtractSender["Extract Sender&lt;br&gt;de = user"]
EmitToRecipient["io.to(Unsupported markdown: codespan).emit()&lt;br&gt;'mensaje_recibido'"]
CheckSenderRole["rol !== 'admin'?"]
EmitToAdmins["io.to('admins').emit()&lt;br&gt;'mensaje_recibido'"]
PersistDB["Persist to Database&lt;br&gt;INSERT INTO mensajes"]
Complete["Message Routing&lt;br&gt;Complete"]

MensajePrivado --&gt; ExtractSender
ExtractSender --&gt; EmitToRecipient
EmitToRecipient --&gt; CheckSenderRole
CheckSenderRole --&gt; EmitToAdmins
CheckSenderRole --&gt; PersistDB
EmitToAdmins --&gt; PersistDB
PersistDB --&gt; Complete</code></pre>
<p><strong>Routing Logic</strong></p>
<p>When a <code>mensaje_privado</code> event is received <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L45-L45">src/sockets/socketHandler.js L45</a></p>
<p>the system executes the following routing:</p>
<ol>
<li><strong>Direct Delivery</strong>: The message is always emitted to the recipient's personal room <code>user:${para}</code> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L48-L48">src/sockets/socketHandler.js L48</a></li>
<li><strong>Admin Broadcast</strong> (conditional): If the sender is NOT an admin (<code>rol !== "admin"</code>), the message is also broadcast to the <code>admins</code> room <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L50-L52">src/sockets/socketHandler.js L50-L52</a></li>
<li><strong>Persistence</strong>: The message is stored in the <code>mensajes</code> database table <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L55-L62">src/sockets/socketHandler.js L55-L62</a></li>
</ol>
<p>This design ensures:</p>
<ul>
<li>Users can send messages directly to administrators</li>
<li>All administrators see incoming user messages (supervision capability)</li>
<li>Admin-to-user messages remain private (only visible to the specific user)</li>
<li>Admin-to-admin messages are visible to all administrators</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L45-L63">src/sockets/socketHandler.js L45-L63</a></p>
<hr />
<h2 id="room-membership-management">Room Membership Management<a class="headerlink" href="#room-membership-management" title="Permanent link">&para;</a></h2>
<h3 id="join-operation">Join Operation<a class="headerlink" href="#join-operation" title="Permanent link">&para;</a></h3>
<p>The <code>socket.join()</code> method adds the current socket to specified room(s). This is a Socket.IO method that maintains room membership internally:</p>
<div class="highlight"><pre><span></span><code>socket.join(`user:${user}`);  // Join personal room
if (rol === &quot;admin&quot;) socket.join(&quot;admins&quot;);  // Conditionally join admin room
</code></pre></div>
<p><strong>Key Characteristics:</strong></p>
<ul>
<li>Membership is per-socket, not per-user (multiple tabs = multiple sockets)</li>
<li>A socket can belong to multiple rooms simultaneously</li>
<li>Room creation is implicit; calling <code>socket.join()</code> creates the room if it doesn't exist</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L42-L43">src/sockets/socketHandler.js L42-L43</a></p>
<h3 id="automatic-leave-on-disconnect">Automatic Leave on Disconnect<a class="headerlink" href="#automatic-leave-on-disconnect" title="Permanent link">&para;</a></h3>
<p>Socket.IO automatically removes disconnected sockets from all rooms they had joined. The <code>disconnect</code> event handler <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L65-L67">src/sockets/socketHandler.js L65-L67</a></p>
<p>logs disconnections but doesn't need to explicitly call <code>socket.leave()</code> for cleanup.</p>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L65-L67">src/sockets/socketHandler.js L65-L67</a></p>
<hr />
<h2 id="message-emission-to-rooms">Message Emission to Rooms<a class="headerlink" href="#message-emission-to-rooms" title="Permanent link">&para;</a></h2>
<h3 id="targeting-specific-rooms">Targeting Specific Rooms<a class="headerlink" href="#targeting-specific-rooms" title="Permanent link">&para;</a></h3>
<p>The <code>io.to()</code> method targets message emission to all sockets in a specified room:</p>
<div class="highlight"><pre><span></span><code>io.to(`user:${para}`).emit(&quot;mensaje_recibido&quot;, { de, mensaje });
</code></pre></div>
<p>This emits the <code>mensaje_recibido</code> event only to sockets in room <code>user:${para}</code>, delivering the message to the intended recipient.</p>
<h3 id="broadcasting-to-multiple-rooms">Broadcasting to Multiple Rooms<a class="headerlink" href="#broadcasting-to-multiple-rooms" title="Permanent link">&para;</a></h3>
<p>When a non-admin sends a message, two <code>io.to()</code> calls execute sequentially:</p>
<div class="highlight"><pre><span></span><code>io.to(`user:${para}`).emit(&quot;mensaje_recibido&quot;, { de, mensaje });  // To recipient
if (rol !== &quot;admin&quot;) {
    io.to(&quot;admins&quot;).emit(&quot;mensaje_recibido&quot;, { de, mensaje });    // To all admins
}
</code></pre></div>
<p>This pattern creates a "broadcast to multiple rooms" behavior without explicit multi-room syntax, ensuring both the recipient and supervising administrators receive the message.</p>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L48-L52">src/sockets/socketHandler.js L48-L52</a></p>
<hr />
<h2 id="room-naming-convention">Room Naming Convention<a class="headerlink" href="#room-naming-convention" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Room Name Pattern</th>
<th>Example</th>
<th>Generated By</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user:${username}</code></td>
<td><code>user:john_doe</code></td>
<td><code>socket.join(\</code>user:${user}<code>)</code></td>
<td>Personal message delivery</td>
</tr>
<tr>
<td><code>admins</code></td>
<td><code>admins</code></td>
<td><code>socket.join("admins")</code></td>
<td>Admin broadcast channel</td>
</tr>
</tbody>
</table>
<p>The <code>user:</code> prefix distinguishes personal rooms from the admin room and provides a namespace-like organization. This prevents collisions if a user has the username <code>admins</code>, as their personal room would be <code>user:admins</code>, distinct from the <code>admins</code> admin room.</p>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L42-L43">src/sockets/socketHandler.js L42-L43</a></p>
<hr />
<h2 id="connection-lifecycle-and-room-membership">Connection Lifecycle and Room Membership<a class="headerlink" href="#connection-lifecycle-and-room-membership" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>sequenceDiagram
  participant Client
  participant Socket.IO Server
  participant JWT Middleware
  participant connection Handler

  Client-&gt;&gt;Socket.IO Server: "Establish WebSocket Connection"
  Socket.IO Server-&gt;&gt;JWT Middleware: "Authenticate (io.use)"
  JWT Middleware-&gt;&gt;JWT Middleware: "Verify JWT from Cookie"
  JWT Middleware--&gt;&gt;Socket.IO Server: "Authentication Success
  Socket.IO Server-&gt;&gt;connection Handler: {user, name, rol}"
  connection Handler-&gt;&gt;connection Handler: "Trigger 'connection' Event"
  loop [rol ===
    connection Handler-&gt;&gt;connection Handler: "socket.join(`user:${user}`)"
    connection Handler--&gt;&gt;Client: "socket.join('admins')"
    note over Client,connection Handler: "Socket now in rooms:
    Client-&gt;&gt;connection Handler: "Connection Established
    connection Handler-&gt;&gt;Socket.IO Server: Rooms Assigned"
    connection Handler-&gt;&gt;Socket.IO Server: "Send 'mensaje_privado'"
  end
  Client-&gt;&gt;Socket.IO Server: "io.to(`user:${para}`).emit()"
  Socket.IO Server-&gt;&gt;connection Handler: "io.to('admins').emit()"
  note over Socket.IO Server: "Automatic room cleanup</code></pre>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L4-L69">src/sockets/socketHandler.js L4-L69</a></p>
<hr />
<h2 id="technical-implementation-details">Technical Implementation Details<a class="headerlink" href="#technical-implementation-details" title="Permanent link">&para;</a></h2>
<h3 id="room-data-structure">Room Data Structure<a class="headerlink" href="#room-data-structure" title="Permanent link">&para;</a></h3>
<p>Socket.IO maintains rooms as a Map-like data structure where:</p>
<ul>
<li>Keys are room names (strings)</li>
<li>Values are Sets of socket IDs</li>
</ul>
<p>This internal structure is managed entirely by Socket.IO; application code interacts with it only through <code>socket.join()</code>, <code>socket.leave()</code>, and <code>io.to()</code> methods.</p>
<h3 id="performance-considerations">Performance Considerations<a class="headerlink" href="#performance-considerations" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Room Lookup</strong>: O(1) complexity for emitting to a room via <code>io.to(roomName)</code></li>
<li><strong>Multi-Room Membership</strong>: No performance penalty; a socket can join unlimited rooms</li>
<li><strong>Broadcast Efficiency</strong>: <code>io.to("admins").emit()</code> iterates only over sockets in that room, not all connected sockets</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L48-L52">src/sockets/socketHandler.js L48-L52</a></p>
<hr />
<h2 id="integration-with-authentication">Integration with Authentication<a class="headerlink" href="#integration-with-authentication" title="Permanent link">&para;</a></h2>
<p>Room assignment depends on authenticated JWT data extracted by the Socket.IO authentication middleware <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L6-L32">src/sockets/socketHandler.js L6-L32</a></p>
<p>The middleware populates <code>socket.request.user</code> with decoded token data, which the connection handler uses to determine room membership:</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">rol</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">socket</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span><span class="w">  </span><span class="c1">// From JWT</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="sb">`user:</span><span class="si">${</span><span class="nx">user</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span><span class="w">                      </span><span class="c1">// Room name from JWT</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rol</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">socket</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;admins&quot;</span><span class="p">);</span><span class="w">       </span><span class="c1">// Conditional on JWT role</span>
</code></pre></div>
<p>This tight coupling ensures room assignment is based on verified identity, preventing users from joining arbitrary rooms or impersonating others.</p>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L6-L43">src/sockets/socketHandler.js L6-L43</a></p>
<hr />
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>The room management system provides a clean abstraction for message routing in the support chat feature:</p>
<ul>
<li><strong>Personal rooms</strong> (<code>user:{username}</code>) enable direct message delivery to specific users</li>
<li>The <strong>admin room</strong> (<code>admins</code>) creates a supervision channel where non-admin messages are broadcast</li>
<li>Room assignment is automatic on connection, based on authenticated JWT data</li>
<li>Message routing logic leverages rooms to implement both direct messaging and admin broadcast patterns</li>
<li>Socket.IO handles room membership lifecycle, including automatic cleanup on disconnect</li>
</ul>
<p>This architecture separates message routing concerns from business logic, making the support chat system scalable and maintainable.</p>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L1-L71">src/sockets/socketHandler.js L1-L71</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["content.code.copy"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
        <script src="javascripts/mermaid-init.js"></script>
      
    
  </body>
</html>