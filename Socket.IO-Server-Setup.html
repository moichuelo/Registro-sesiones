
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentación del proyecto Registro (DeepWiki dump)">
      
      
      
      
        <link rel="prev" href="Real-time-Communication-System.html">
      
      
        <link rel="next" href="WebSocket-Authentication.html">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Socket.IO Server Setup - DeepWiki — Registro</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#socketio-server-setup" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="DeepWiki — Registro" class="md-header__button md-logo" aria-label="DeepWiki — Registro" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DeepWiki — Registro
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Socket.IO Server Setup
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="cyan"  aria-label="Modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="DeepWiki — Registro" class="md-nav__button md-logo" aria-label="DeepWiki — Registro" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    DeepWiki — Registro
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Getting-Started.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture Overview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Architecture-Overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="System-Components.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    System Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Technology-Stack.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Technology Stack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Request-Processing-Pipeline.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Request Processing Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Application-Bootstrap.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Application Bootstrap
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Routing System
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Routing System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Routing-System.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Routing System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Public-Routes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Public Routes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Protected-Routes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protected Routes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="API-Endpoints.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Endpoints
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Authentication & Authorization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Authentication & Authorization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Authentication-%26-Authorization.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authentication & Authorization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="User-Registration-%26-Login.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Registration & Login
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="JWT-Token-Management.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JWT Token Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="verifyToken-Middleware.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    verifyToken Middleware
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Security-Measures.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security Measures
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Real-time Communication System
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Real-time Communication System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Real-time-Communication-System.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Real-time Communication System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Socket.IO Server Setup
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="Socket.IO-Server-Setup.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Socket.IO Server Setup
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose-and-scope" class="md-nav__link">
    <span class="md-ellipsis">
      Purpose and Scope
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Server Architecture Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-server-and-socketio-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Server and Socket.IO Initialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP Server and Socket.IO Initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-http-server" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the HTTP Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#socketio-server-instantiation" class="md-nav__link">
    <span class="md-ellipsis">
      Socket.IO Server Instantiation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#socket-handler-setup-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Socket Handler Setup Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Socket Handler Setup Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setupsocket-function-registration" class="md-nav__link">
    <span class="md-ellipsis">
      setupSocket Function Registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setupsocket-function-structure" class="md-nav__link">
    <span class="md-ellipsis">
      setupSocket Function Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-middleware-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Middleware Registration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication Middleware Registration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#middleware-execution-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Middleware Execution Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cookie-and-token-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      Cookie and Token Extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwt-verification-and-user-attachment" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Verification and User Attachment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connection-handler-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Handler Registration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connection Handler Registration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ioonconnection-setup" class="md-nav__link">
    <span class="md-ellipsis">
      io.on("connection") Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-information-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      User Information Extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#room-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      Room Assignment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-startup-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      Server Startup Sequence
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Server Startup Sequence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#complete-initialization-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Initialization Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listening-on-port-3000" class="md-nav__link">
    <span class="md-ellipsis">
      Listening on Port 3000
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-configuration-points" class="md-nav__link">
    <span class="md-ellipsis">
      Key Configuration Points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-express-application" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Express Application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration with Express Application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shared-http-server-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      Shared HTTP Server Pattern
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies-and-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Dependencies and Modules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dependencies and Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#required-npm-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Required npm Packages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-imports" class="md-nav__link">
    <span class="md-ellipsis">
      Module Imports
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#console-logging" class="md-nav__link">
    <span class="md-ellipsis">
      Console Logging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-setup-code-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Setup Code Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Setup Code Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#indexjs-initialization-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      index.js Initialization Sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sockethandlerjs-configuration-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      socketHandler.js Configuration Sequence
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="WebSocket-Authentication.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WebSocket Authentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Room-Management.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Room Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Message-Handling.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Message Handling
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Product-Management.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Product Management
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Support Chat System
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Support Chat System
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Support-Chat-System.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Support Chat System
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="User-Chat-Interface.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Chat Interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Admin-Chat-Interface.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Admin Chat Interface
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    PDF Generation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            PDF Generation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="PDF-Generation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PDF Generation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Puppeteer-PDF-Generation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Puppeteer PDF Generation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="PDFKit-PDF-Generation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PDFKit PDF Generation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Internationalization-%28i18n%29.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internationalization (i18n)
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    View Layer & Templates
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            View Layer & Templates
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Template-Structure.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Template Structure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Partial-Components.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Partial Components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Page-Views.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Page Views
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Static-Assets-%26-Styling.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Static Assets & Styling
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Database Schema
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            Database Schema
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Database-Schema.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Database Schema
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="usuarios-Table.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    usuarios Table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="productos-Table.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    productos Table
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mensajes-Table.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mensajes Table
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="API-Reference.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="HTTP-Endpoints.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTTP Endpoints
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="WebSocket-Events.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WebSocket Events
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="Deployment-%26-Configuration.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment & Configuration
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    README
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose-and-scope" class="md-nav__link">
    <span class="md-ellipsis">
      Purpose and Scope
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-architecture-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Server Architecture Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-server-and-socketio-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Server and Socket.IO Initialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTP Server and Socket.IO Initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-http-server" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the HTTP Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#socketio-server-instantiation" class="md-nav__link">
    <span class="md-ellipsis">
      Socket.IO Server Instantiation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#socket-handler-setup-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Socket Handler Setup Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Socket Handler Setup Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setupsocket-function-registration" class="md-nav__link">
    <span class="md-ellipsis">
      setupSocket Function Registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setupsocket-function-structure" class="md-nav__link">
    <span class="md-ellipsis">
      setupSocket Function Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication-middleware-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Middleware Registration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Authentication Middleware Registration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#middleware-execution-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Middleware Execution Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cookie-and-token-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      Cookie and Token Extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jwt-verification-and-user-attachment" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Verification and User Attachment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connection-handler-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Handler Registration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connection Handler Registration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ioonconnection-setup" class="md-nav__link">
    <span class="md-ellipsis">
      io.on("connection") Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-information-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      User Information Extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#room-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      Room Assignment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#server-startup-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      Server Startup Sequence
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Server Startup Sequence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#complete-initialization-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Initialization Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listening-on-port-3000" class="md-nav__link">
    <span class="md-ellipsis">
      Listening on Port 3000
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-configuration-points" class="md-nav__link">
    <span class="md-ellipsis">
      Key Configuration Points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-express-application" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Express Application
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration with Express Application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shared-http-server-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      Shared HTTP Server Pattern
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies-and-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Dependencies and Modules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dependencies and Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#required-npm-packages" class="md-nav__link">
    <span class="md-ellipsis">
      Required npm Packages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-imports" class="md-nav__link">
    <span class="md-ellipsis">
      Module Imports
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authentication-errors" class="md-nav__link">
    <span class="md-ellipsis">
      Authentication Errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#console-logging" class="md-nav__link">
    <span class="md-ellipsis">
      Console Logging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-setup-code-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Setup Code Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Setup Code Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#indexjs-initialization-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      index.js Initialization Sequence
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sockethandlerjs-configuration-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      socketHandler.js Configuration Sequence
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="socketio-server-setup">Socket.IO Server Setup<a class="headerlink" href="#socketio-server-setup" title="Permanent link">&para;</a></h1>
<blockquote>
<p><strong>Relevant source files</strong>
* <a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js">index.js</a>
* <a href="https://github.com/moichuelo/registro/blob/544abbcc/package-lock.json">package-lock.json</a>
* <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js">src/sockets/socketHandler.js</a></p>
</blockquote>
<h2 id="purpose-and-scope">Purpose and Scope<a class="headerlink" href="#purpose-and-scope" title="Permanent link">&para;</a></h2>
<p>This document covers the initialization and configuration of the Socket.IO server, including server creation, Socket.IO attachment to the HTTP server, authentication middleware registration, and connection handler setup. For information about WebSocket authentication mechanisms and JWT validation, see <a href="WebSocket-Authentication.html">WebSocket Authentication</a>. For room-based routing and user organization, see <a href="Room-Management.html">Room Management</a>. For event handling and message processing, see <a href="Message-Handling.html">Message Handling</a>.</p>
<hr />
<h2 id="server-architecture-overview">Server Architecture Overview<a class="headerlink" href="#server-architecture-overview" title="Permanent link">&para;</a></h2>
<p>The Socket.IO server shares the same HTTP server instance as the Express application, enabling both traditional HTTP request-response patterns and WebSocket bidirectional communication on a single port.</p>
<pre class="mermaid"><code>flowchart TD

HTTPServer["http.createServer(app)"]
ExpressApp["Express Application&lt;br&gt;app = express()"]
SocketIOServer["Socket.IO Server&lt;br&gt;io = socketIO(server)"]
SetupSocket["setupSocket(io)&lt;br&gt;src/sockets/socketHandler.js"]
AuthMiddleware["io.use()&lt;br&gt;JWT Authentication Middleware"]
ConnectionHandler["io.on('connection')&lt;br&gt;Socket Event Handlers"]
ListenPort["Port 3000"]

ExpressApp --&gt; HTTPServer
HTTPServer --&gt; SocketIOServer
SocketIOServer --&gt; SetupSocket
SetupSocket --&gt; AuthMiddleware
SetupSocket --&gt; ConnectionHandler
HTTPServer --&gt; ListenPort</code></pre>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L8-L14">index.js L8-L14</a></p>
<p><a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L56-L65">index.js L56-L65</a></p>
<hr />
<h2 id="http-server-and-socketio-initialization">HTTP Server and Socket.IO Initialization<a class="headerlink" href="#http-server-and-socketio-initialization" title="Permanent link">&para;</a></h2>
<h3 id="creating-the-http-server">Creating the HTTP Server<a class="headerlink" href="#creating-the-http-server" title="Permanent link">&para;</a></h3>
<p>The HTTP server is created using Node.js's built-in <code>http</code> module, wrapping the Express application instance. This approach allows Socket.IO to attach to the same server that handles HTTP requests.</p>
<table>
<thead>
<tr>
<th>Step</th>
<th>Code Entity</th>
<th>Location</th>
</tr>
</thead>
<tbody>
<tr>
<td>1. Require HTTP module</td>
<td><code>const http = require("http")</code></td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L8-L8">index.js L8</a></td>
</tr>
<tr>
<td>2. Require Socket.IO</td>
<td><code>const socketIO = require("socket.io")</code></td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L9-L9">index.js L9</a></td>
</tr>
<tr>
<td>3. Create HTTP server</td>
<td><code>const server = http.createServer(app)</code></td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L10-L10">index.js L10</a></td>
</tr>
<tr>
<td>4. Initialize Socket.IO</td>
<td><code>const io = socketIO(server)</code></td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L12-L12">index.js L12</a></td>
</tr>
</tbody>
</table>
<p>The <code>server</code> constant holds the HTTP server instance that both Express and Socket.IO use. The Express app is passed to <code>http.createServer()</code>, which wraps it as an HTTP request listener.</p>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L8-L12">index.js L8-L12</a></p>
<h3 id="socketio-server-instantiation">Socket.IO Server Instantiation<a class="headerlink" href="#socketio-server-instantiation" title="Permanent link">&para;</a></h3>
<p>The Socket.IO server is instantiated by calling <code>socketIO(server)</code>, where <code>server</code> is the HTTP server instance. This creates the <code>io</code> object, which represents the Socket.IO server and provides methods for middleware registration and event handling.</p>
<pre class="mermaid"><code>sequenceDiagram
  participant index.js
  participant http.createServer
  participant Express App
  participant Socket.IO Server

  index.js-&gt;&gt;Express App: require("express")
  index.js-&gt;&gt;Express App: app = express()
  index.js-&gt;&gt;http.createServer: http.createServer(app)
  http.createServer--&gt;&gt;index.js: server
  index.js-&gt;&gt;Socket.IO Server: socketIO(server)
  Socket.IO Server--&gt;&gt;index.js: io
  note over index.js,Socket.IO Server: Both Express and Socket.IO</code></pre>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L2-L12">index.js L2-L12</a></p>
<hr />
<h2 id="socket-handler-setup-integration">Socket Handler Setup Integration<a class="headerlink" href="#socket-handler-setup-integration" title="Permanent link">&para;</a></h2>
<h3 id="setupsocket-function-registration">setupSocket Function Registration<a class="headerlink" href="#setupsocket-function-registration" title="Permanent link">&para;</a></h3>
<p>The <code>setupSocket</code> function from <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js">src/sockets/socketHandler.js</a></p>
<p>is invoked to configure authentication middleware and connection handlers. This function encapsulates all Socket.IO configuration logic.</p>
<pre class="mermaid"><code>flowchart TD

IO["io&lt;br&gt;(Socket.IO Server Instance)"]
Setup["setupSocket(io)&lt;br&gt;src/sockets/socketHandler.js"]
AuthMW["io.use((socket, next) =&gt; {...})&lt;br&gt;JWT Authentication"]
ConnHandler["io.on('connection', (socket) =&gt; {...})&lt;br&gt;Event Handlers"]

IO --&gt; Setup
Setup --&gt; AuthMW
Setup --&gt; ConnHandler
AuthMW --&gt; ConnHandler</code></pre>
<p>The function is called immediately after the <code>io</code> instance is created and before the HTTP server starts listening:</p>
<table>
<thead>
<tr>
<th>Line</th>
<th>Action</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L14-L14">index.js L14</a></td>
<td><code>const setupSocket = require("./src/sockets/socketHandler")</code></td>
<td>Import handler setup function</td>
</tr>
<tr>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L57-L57">index.js L57</a></td>
<td><code>setupSocket(io)</code></td>
<td>Configure Socket.IO with authentication and event handlers</td>
</tr>
<tr>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L62-L62">index.js L62</a></td>
<td><code>server.listen(3000, ...)</code></td>
<td>Start HTTP server with both Express and Socket.IO</td>
</tr>
</tbody>
</table>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L14-L14">index.js L14</a></p>
<p><a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L56-L65">index.js L56-L65</a></p>
<h3 id="setupsocket-function-structure">setupSocket Function Structure<a class="headerlink" href="#setupsocket-function-structure" title="Permanent link">&para;</a></h3>
<p>The <code>setupSocket</code> function accepts the <code>io</code> instance and configures it in two stages:</p>
<ol>
<li><strong>Authentication Middleware Registration</strong> (<a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L6-L32">src/sockets/socketHandler.js L6-L32</a> )</li>
<li><strong>Connection Event Handler Registration</strong> (<a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L36-L68">src/sockets/socketHandler.js L36-L68</a> )</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">setupSocket</span><span class="p">(</span><span class="nx">io</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Stage 1: Authentication middleware</span>
<span class="w">    </span><span class="nx">io</span><span class="p">.</span><span class="nx">use</span><span class="p">((</span><span class="nx">socket</span><span class="p">,</span><span class="w"> </span><span class="nx">next</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// JWT validation from cookies</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Stage 2: Connection handler</span>
<span class="w">    </span><span class="nx">io</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;connection&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">socket</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Event listeners for messages, disconnect, etc.</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L4-L69">src/sockets/socketHandler.js L4-L69</a></p>
<hr />
<h2 id="authentication-middleware-registration">Authentication Middleware Registration<a class="headerlink" href="#authentication-middleware-registration" title="Permanent link">&para;</a></h2>
<h3 id="middleware-execution-flow">Middleware Execution Flow<a class="headerlink" href="#middleware-execution-flow" title="Permanent link">&para;</a></h3>
<p>Socket.IO middleware functions execute before connection handlers, enabling authentication and authorization checks before a client can establish a WebSocket connection.</p>
<pre class="mermaid"><code>sequenceDiagram
  participant WebSocket Client
  participant io.use() Middleware
  participant io.on("connection")
  participant MySQL Database

  WebSocket Client-&gt;&gt;io.use() Middleware: WebSocket Upgrade Request
  io.use() Middleware-&gt;&gt;io.use() Middleware: Extract cookies from socket.request
  io.use() Middleware-&gt;&gt;io.use() Middleware: Find token cookie
  loop [Valid token]
    io.use() Middleware-&gt;&gt;io.use() Middleware: jwt.verify(token, JWT_SECRET)
    io.use() Middleware-&gt;&gt;io.use() Middleware: socket.request.user = decoded
    io.use() Middleware-&gt;&gt;io.on("connection"): next() - Allow connection
    io.on("connection")-&gt;&gt;io.on("connection"): socket.join() rooms
    io.on("connection")--&gt;&gt;WebSocket Client: Connection established
    io.use() Middleware--&gt;&gt;WebSocket Client: Error("Token inválido")
    io.use() Middleware--&gt;&gt;WebSocket Client: Error("Token no proporcionado")
  end</code></pre>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L6-L32">src/sockets/socketHandler.js L6-L32</a></p>
<h3 id="cookie-and-token-extraction">Cookie and Token Extraction<a class="headerlink" href="#cookie-and-token-extraction" title="Permanent link">&para;</a></h3>
<p>The middleware extracts the JWT token from HTTP cookies attached to the WebSocket upgrade request:</p>
<table>
<thead>
<tr>
<th>Step</th>
<th>Code</th>
<th>Location</th>
</tr>
</thead>
<tbody>
<tr>
<td>Access request</td>
<td><code>const req = socket.request</code></td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L7-L7">src/sockets/socketHandler.js L7</a></td>
</tr>
<tr>
<td>Extract cookies</td>
<td><code>const cookies = req.headers.cookie</code></td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L8-L8">src/sockets/socketHandler.js L8</a></td>
</tr>
<tr>
<td>Parse token</td>
<td><code>const tokenMatch = cookies.match(/token=([^;]+)/)</code></td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L16-L16">src/sockets/socketHandler.js L16</a></td>
</tr>
<tr>
<td>Extract value</td>
<td><code>const token = tokenMatch &amp;&amp; tokenMatch[1]</code></td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L17-L17">src/sockets/socketHandler.js L17</a></td>
</tr>
</tbody>
</table>
<p>The token is expected to be stored in a cookie named <code>token</code>, which is set during login via HTTP routes (see <a href="User-Registration-%26-Login.html">User Registration &amp; Login</a>).</p>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L7-L17">src/sockets/socketHandler.js L7-L17</a></p>
<h3 id="jwt-verification-and-user-attachment">JWT Verification and User Attachment<a class="headerlink" href="#jwt-verification-and-user-attachment" title="Permanent link">&para;</a></h3>
<p>The extracted token is verified using the <code>jsonwebtoken</code> library with the secret key from environment variables:</p>
<pre class="mermaid"><code>flowchart TD

Token["JWT Token from Cookie"]
Verify["jwt.verify(token, JWT_SECRET)"]
Decoded["Decoded Payload&lt;br&gt;{user, name, rol}"]
Attach["socket.request.user = decoded"]
Next["next() - Proceed to connection"]
Error["next(new Error())"]

Token --&gt; Verify
Verify --&gt; Decoded
Verify --&gt; Error
Decoded --&gt; Attach
Attach --&gt; Next</code></pre>
<p>The decoded JWT payload contains:</p>
<ul>
<li><code>user</code>: Username (primary key from <code>usuarios</code> table)</li>
<li><code>name</code>: Full name</li>
<li><code>rol</code>: Role (<code>"admin"</code> or <code>"user"</code>)</li>
</ul>
<p>These fields are attached to <code>socket.request.user</code> for access in the connection handler.</p>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L24-L31">src/sockets/socketHandler.js L24-L31</a></p>
<p><a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L6-L6">index.js L6</a></p>
<hr />
<h2 id="connection-handler-registration">Connection Handler Registration<a class="headerlink" href="#connection-handler-registration" title="Permanent link">&para;</a></h2>
<h3 id="ioonconnection-setup">io.on("connection") Setup<a class="headerlink" href="#ioonconnection-setup" title="Permanent link">&para;</a></h3>
<p>After passing authentication middleware, the connection event fires with an authenticated socket instance. The handler extracts user information and sets up event listeners.</p>
<pre class="mermaid"><code>flowchart TD

Connection["io.on('connection', (socket) =&gt; {})"]
Extract["Extract user info&lt;br&gt;const {user, name, rol} = socket.request.user"]
JoinRooms["socket.join() - Assign rooms&lt;br&gt;user:username + admins"]
RegisterEvents["Register event handlers"]
MPE["socket.on('mensaje_privado')"]
Disconnect["socket.on('disconnect')"]

Connection --&gt; Extract
Extract --&gt; JoinRooms
JoinRooms --&gt; RegisterEvents
RegisterEvents --&gt; MPE
RegisterEvents --&gt; Disconnect</code></pre>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L36-L68">src/sockets/socketHandler.js L36-L68</a></p>
<h3 id="user-information-extraction">User Information Extraction<a class="headerlink" href="#user-information-extraction" title="Permanent link">&para;</a></h3>
<p>The connection handler immediately destructures the authenticated user data from <code>socket.request.user</code>, which was populated by the authentication middleware:</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Source</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>user</code></td>
<td><code>socket.request.user.user</code></td>
<td>Username for room assignment and message routing</td>
</tr>
<tr>
<td><code>name</code></td>
<td><code>socket.request.user.name</code></td>
<td>Display name (not actively used in handler)</td>
</tr>
<tr>
<td><code>rol</code></td>
<td><code>socket.request.user.rol</code></td>
<td>Role for admin room assignment and message routing</td>
</tr>
</tbody>
</table>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L37-L37">src/sockets/socketHandler.js L37</a></p>
<h3 id="room-assignment">Room Assignment<a class="headerlink" href="#room-assignment" title="Permanent link">&para;</a></h3>
<p>Each connected socket is assigned to rooms based on the authenticated user's identity and role:</p>
<div class="highlight"><pre><span></span><code>socket.join(`user:${user}`);           // Personal room for direct messages
if (rol === &quot;admin&quot;) socket.join(&quot;admins&quot;);  // Admin broadcast room
</code></pre></div>
<p>See <a href="Room-Management.html">Room Management</a> for detailed information on room-based routing strategy.</p>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L42-L43">src/sockets/socketHandler.js L42-L43</a></p>
<hr />
<h2 id="server-startup-sequence">Server Startup Sequence<a class="headerlink" href="#server-startup-sequence" title="Permanent link">&para;</a></h2>
<h3 id="complete-initialization-flow">Complete Initialization Flow<a class="headerlink" href="#complete-initialization-flow" title="Permanent link">&para;</a></h3>
<p>The following diagram shows the complete startup sequence from application bootstrap to ready state:</p>
<pre class="mermaid"><code>sequenceDiagram
  participant Application Bootstrap
  participant Express App
  participant HTTP Server
  participant Socket.IO Server
  participant setupSocket()
  participant Port 3000

  Application Bootstrap-&gt;&gt;Express App: Initialize Express
  Application Bootstrap-&gt;&gt;Express App: Configure middleware
  Application Bootstrap-&gt;&gt;HTTP Server: (helmet, body-parser, etc.)
  Application Bootstrap-&gt;&gt;Socket.IO Server: http.createServer(app)
  Application Bootstrap-&gt;&gt;setupSocket(): socketIO(server)
  setupSocket()-&gt;&gt;Socket.IO Server: setupSocket(io)
  setupSocket()-&gt;&gt;Socket.IO Server: io.use() - Auth middleware
  Application Bootstrap-&gt;&gt;Port 3000: io.on("connection") - Handler
  note over Application Bootstrap,Port 3000: Server ready for both</code></pre>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L1-L65">index.js L1-L65</a></p>
<h3 id="listening-on-port-3000">Listening on Port 3000<a class="headerlink" href="#listening-on-port-3000" title="Permanent link">&para;</a></h3>
<p>The HTTP server (with both Express and Socket.IO attached) starts listening on port 3000:</p>
<div class="highlight"><pre><span></span><code><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">3000</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Servidor corriendo en http://localhost:3000&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Swagger disponible en http://localhost:3000/api-docs&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>This single <code>server.listen()</code> call makes both HTTP routes (via Express) and WebSocket connections (via Socket.IO) available on the same port.</p>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L62-L65">index.js L62-L65</a></p>
<hr />
<h2 id="configuration-summary">Configuration Summary<a class="headerlink" href="#configuration-summary" title="Permanent link">&para;</a></h2>
<h3 id="key-configuration-points">Key Configuration Points<a class="headerlink" href="#key-configuration-points" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Configuration Aspect</th>
<th>Location</th>
<th>Value/Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td>Socket.IO Version</td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/package-lock.json">package-lock.json</a></td>
<td>4.8.1</td>
</tr>
<tr>
<td>HTTP Server Module</td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L8-L8">index.js L8</a></td>
<td>Node.js built-in <code>http</code></td>
</tr>
<tr>
<td>Server Port</td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L62-L62">index.js L62</a></td>
<td>3000</td>
</tr>
<tr>
<td>Authentication Method</td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L6-L6">src/sockets/socketHandler.js L6</a></td>
<td>JWT from HTTP-only cookie</td>
</tr>
<tr>
<td>JWT Secret Source</td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L4-L4">index.js L4</a></td>
<td><code>process.env.JWT_SECRET</code></td>
</tr>
<tr>
<td>Socket Handler Module</td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L14-L14">index.js L14</a></td>
<td><code>./src/sockets/socketHandler</code></td>
</tr>
<tr>
<td>Middleware Type</td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L6-L6">src/sockets/socketHandler.js L6</a></td>
<td><code>io.use()</code> authentication middleware</td>
</tr>
<tr>
<td>Connection Event</td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L36-L36">src/sockets/socketHandler.js L36</a></td>
<td><code>io.on("connection")</code></td>
</tr>
</tbody>
</table>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L1-L65">index.js L1-L65</a></p>
<p><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L1-L71">src/sockets/socketHandler.js L1-L71</a></p>
<p><a href="https://github.com/moichuelo/registro/blob/544abbcc/package-lock.json#L29-L29">package-lock.json L29</a></p>
<hr />
<h2 id="integration-with-express-application">Integration with Express Application<a class="headerlink" href="#integration-with-express-application" title="Permanent link">&para;</a></h2>
<h3 id="shared-http-server-pattern">Shared HTTP Server Pattern<a class="headerlink" href="#shared-http-server-pattern" title="Permanent link">&para;</a></h3>
<p>Both Express and Socket.IO operate on the same HTTP server instance, allowing them to coexist on a single port. This pattern is essential for several reasons:</p>
<ol>
<li><strong>Single Port Deployment</strong>: Only one port needs to be exposed and configured in firewalls</li>
<li><strong>Shared Session Context</strong>: Both systems can access the same cookies and headers</li>
<li><strong>Unified Authentication</strong>: JWT tokens in cookies work for both HTTP and WebSocket requests</li>
<li><strong>Simplified Load Balancing</strong>: A single endpoint for all application traffic</li>
</ol>
<pre class="mermaid"><code>flowchart TD

Client["Client Browser"]
Server["HTTP Server :3000"]
Express["Express Middleware Stack"]
SIO["Socket.IO Server"]
Routes["HTTP Routes&lt;br&gt;/login, /admin, etc."]
WSHandlers["WebSocket Handlers&lt;br&gt;mensaje_privado, disconnect"]

Client --&gt; Server
Client --&gt; Server
Server --&gt; Express
Server --&gt; SIO
Express --&gt; Routes
SIO --&gt; WSHandlers
Express --&gt; Client
SIO --&gt; Client</code></pre>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L2-L12">index.js L2-L12</a></p>
<p>Diagram 1 from high-level architecture</p>
<hr />
<h2 id="dependencies-and-modules">Dependencies and Modules<a class="headerlink" href="#dependencies-and-modules" title="Permanent link">&para;</a></h2>
<h3 id="required-npm-packages">Required npm Packages<a class="headerlink" href="#required-npm-packages" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Package</th>
<th>Version</th>
<th>Purpose in Socket.IO Setup</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>socket.io</code></td>
<td>4.8.1</td>
<td>WebSocket server implementation</td>
</tr>
<tr>
<td><code>http</code></td>
<td>Built-in</td>
<td>HTTP server for Socket.IO attachment</td>
</tr>
<tr>
<td><code>jsonwebtoken</code></td>
<td>9.0.2</td>
<td>JWT verification in middleware</td>
</tr>
<tr>
<td><code>dotenv</code></td>
<td>16.5.0</td>
<td>Environment variable loading (JWT_SECRET)</td>
</tr>
</tbody>
</table>
<h3 id="module-imports">Module Imports<a class="headerlink" href="#module-imports" title="Permanent link">&para;</a></h3>
<p>The Socket.IO setup requires the following imports across two files:</p>
<p><strong>index.js:</strong></p>
<ul>
<li><code>http</code> - HTTP server creation</li>
<li><code>socket.io</code> - Socket.IO server instantiation</li>
<li><code>./src/sockets/socketHandler</code> - Configuration function</li>
</ul>
<p><strong>src/sockets/socketHandler.js:</strong></p>
<ul>
<li><code>jsonwebtoken</code> - Token verification</li>
<li><code>../../database/db</code> - Database connection for message persistence</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L8-L14">index.js L8-L14</a></p>
<p><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L1-L3">src/sockets/socketHandler.js L1-L3</a></p>
<p><a href="https://github.com/moichuelo/registro/blob/544abbcc/package-lock.json#L29-L29">package-lock.json L29</a></p>
<hr />
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<h3 id="authentication-errors">Authentication Errors<a class="headerlink" href="#authentication-errors" title="Permanent link">&para;</a></h3>
<p>The authentication middleware handles three error conditions:</p>
<table>
<thead>
<tr>
<th>Condition</th>
<th>Detection</th>
<th>Error Response</th>
<th>Code Location</th>
</tr>
</thead>
<tbody>
<tr>
<td>No cookies present</td>
<td><code>!cookies</code></td>
<td><code>Error("No autenticado")</code></td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L10-L13">src/sockets/socketHandler.js L10-L13</a></td>
</tr>
<tr>
<td>Token not found in cookies</td>
<td><code>!token</code></td>
<td><code>Error("Token no proporcionado")</code></td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L19-L22">src/sockets/socketHandler.js L19-L22</a></td>
</tr>
<tr>
<td>Invalid/expired JWT</td>
<td><code>jwt.verify()</code> throws</td>
<td><code>Error("Token inválido")</code></td>
<td><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L28-L31">src/sockets/socketHandler.js L28-L31</a></td>
</tr>
</tbody>
</table>
<p>When any of these errors occur, the WebSocket connection is rejected, and the client receives an error event.</p>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L10-L31">src/sockets/socketHandler.js L10-L31</a></p>
<h3 id="console-logging">Console Logging<a class="headerlink" href="#console-logging" title="Permanent link">&para;</a></h3>
<p>The socket handler logs key events for debugging and monitoring:</p>
<div class="highlight"><pre><span></span><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;❌ No hay cookies en la conexión de socket&quot;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;❌ No se encontró el token en las cookies&quot;</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;❌ Token inválido:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`🟢 Usuario conectado: </span><span class="si">${</span><span class="nx">user</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">rol</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`🔴 Usuario desconectado: </span><span class="si">${</span><span class="nx">user</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</code></pre></div>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L11-L11">src/sockets/socketHandler.js L11</a></p>
<p><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L20-L20">src/sockets/socketHandler.js L20</a></p>
<p><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L29-L29">src/sockets/socketHandler.js L29</a></p>
<p><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L39-L39">src/sockets/socketHandler.js L39</a></p>
<p><a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L66-L66">src/sockets/socketHandler.js L66</a></p>
<hr />
<h2 id="complete-setup-code-flow">Complete Setup Code Flow<a class="headerlink" href="#complete-setup-code-flow" title="Permanent link">&para;</a></h2>
<h3 id="indexjs-initialization-sequence">index.js Initialization Sequence<a class="headerlink" href="#indexjs-initialization-sequence" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>flowchart TD

Start["Application Start"]
LoadEnv["Load environment variables&lt;br&gt;dotenv.config()"]
InitExpress["Initialize Express&lt;br&gt;const app = express()"]
CreateHTTP["Create HTTP server&lt;br&gt;const server = http.createServer(app)"]
CreateSIO["Create Socket.IO server&lt;br&gt;const io = socketIO(server)"]
ConfigMiddleware["Configure Express middleware&lt;br&gt;body-parser, helmet, sessions, etc."]
SetupSockets["Setup Socket.IO&lt;br&gt;setupSocket(io)"]
Listen["Start listening&lt;br&gt;server.listen(3000)"]
End["Server Ready"]

Start --&gt; LoadEnv
LoadEnv --&gt; InitExpress
InitExpress --&gt; CreateHTTP
CreateHTTP --&gt; CreateSIO
CreateSIO --&gt; ConfigMiddleware
ConfigMiddleware --&gt; SetupSockets
SetupSockets --&gt; Listen
Listen --&gt; End</code></pre>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/index.js#L1-L65">index.js L1-L65</a></p>
<h3 id="sockethandlerjs-configuration-sequence">socketHandler.js Configuration Sequence<a class="headerlink" href="#sockethandlerjs-configuration-sequence" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>flowchart TD

Entry["setupSocket(io)"]
RegAuth["Register authentication middleware&lt;br&gt;io.use((socket, next) =&gt; {...})"]
RegConn["Register connection handler&lt;br&gt;io.on('connection', (socket) =&gt; {...})"]
ReturnFunc["Return (function complete)"]
ClientConn["Client connection attempt"]
ExecAuth["Execute auth middleware"]
AuthCheck["Authentication&lt;br&gt;successful?"]
ExecConn["Execute connection handler"]
RoomJoin["Assign to rooms"]
RegEvents["Register message events"]
ConnEst["Connection established"]
Reject["Reject connection"]

Entry --&gt; RegAuth
RegAuth --&gt; RegConn
RegConn --&gt; ReturnFunc
ClientConn --&gt; ExecAuth
ExecAuth --&gt; AuthCheck
AuthCheck --&gt; ExecConn
AuthCheck --&gt; Reject
ExecConn --&gt; RoomJoin
RoomJoin --&gt; RegEvents
RegEvents --&gt; ConnEst</code></pre>
<p><strong>Sources:</strong> <a href="https://github.com/moichuelo/registro/blob/544abbcc/src/sockets/socketHandler.js#L4-L69">src/sockets/socketHandler.js L4-L69</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["content.code.copy"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
      
        <script src="javascripts/mermaid-init.js"></script>
      
    
  </body>
</html>